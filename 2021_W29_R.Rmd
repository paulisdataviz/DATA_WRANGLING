---
title: "2021_W29_prepping_data"
author: "Paula Munoz"
date: "7/26/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 2021: Week 29 - PD x WOW - Tokyo 2020 Calendar

Challenge by Tom Prowse with collaboration with the Workout Wednesday team!

Challenge Link: <https://preppindata.blogspot.com/2021/07/2021-week-29-pd-x-wow-tokyo-2020.html>.

### CHALLENGE DETAILS

### Inputs

The data comes from the Olympics website. (Note; this was taken on Wednesday 14th July.

#### 1. Event Schedule
A list of all the event dates, times and locations throughout the games

#### 2. Venue Details
A list of all of the different venue locations

### Requirements

* Input the Data 
* Create a correctly formatted DateTime field 
* Parse the event list so each event is on a separate row 
* Group similar sports into a Sport Type field 
* Combine the Venue table 
* Calculate whether the event is a 'Victory Ceremony' or 'Gold Medal' event. (Note, this might not pick up all of the medal events.)
* Output the Data


## LOADING LIBRARIES 

```{r pressure, message=FALSE}
library(tidyverse)
library(skimr)
library(lubridate)
library(knitr)
```
```{r}

```

## IMPORTING DATA 

Data resides in a .xlsx file, and it has two sheets:
* Event Schedule
* Venue Details

```{r}
event_schedule_tbl <- readxl::read_excel(path = '../DATA_WRANGLING/2021_W29_prepping_data_files/Olympic Events.xlsx', 
                                         sheet = 1)

venue_details_tbl <- readxl::read_excel(path = '../DATA_WRANGLING/2021_W29_prepping_data_files/Olympic Events.xlsx', 
                                        sheet = 2)
```


## INSPECTING DATA 

**event scheduled table**

* Inspecting first five rows:
```{r}
event_schedule_tbl %>%
  head() %>%
  kable()
```


* Detailed summary:
```{r}
event_schedule_tbl %>%
  skim()
```


* Glimpse data:
```{r}
event_schedule_tbl %>%
  glimpse()
```



**venue details table**

* Detailed summary of:
```{r}
venue_details_tbl %>%
  skim()
```


* Glimpse data:
```{r}
venue_details_tbl %>%
  glimpse()
```


## DATA WRANGLING

### 1. Create a correctly formatted DateTime field (on event_schedule_tbl)

```{r}
event_schedule_clean_1_tbl <- event_schedule_tbl %>%
  # First cleaning the Time column and replacing xx -> 0:00
  mutate(Time = recode(Time, xx = '0:00')) %>%
  # Separate Date Field into different columns to do some cleanup on dateparts late on
  separate(Date, into = c("Day", "Month", "Year"), sep = "_") %>%
  # Remove letters from Day Field
  mutate(Day = str_extract(Day,"[[:digit:]]+")) %>%
  # Paste Date Time related columns into a single field
  mutate(Date = paste(Year, Month, Day, Time, sep ="-")) %>%
  # Convert to datetimeformat
  mutate(Date = ymd_hm(Date)) %>%
  # Remove individual Date columns
  select(-Day:-Time)

event_schedule_clean_1_tbl %>%
  head(10) %>%
  kable()
```


### 2. Parse the event list so each event is on a separate row 

```{r}
event_schedule_clean_2_tbl <- event_schedule_clean_1_tbl %>%
  # Separate events into different rows
  separate_rows(Events, 
                sep = ',',
                convert = TRUE) %>%
  # Trim spaces on Events
  mutate(Events = str_trim(Events))

event_schedule_clean_2_tbl %>%
  head(10) %>%
  kable()
```


### 3. Group similar sports into a Sport Type field

```{r}
#Inspecting Sport column - 64 sports
event_schedule_clean_2_tbl %>%
  count(Sport) 

```


```{r}
event_schedule_clean_3_tbl  <- event_schedule_clean_2_tbl %>%
  # Remove Punctuation (Excluding "/") >> Reduces Sports list from 64 to 60
  mutate(Sport = str_replace(Sport, "[\\p{P}\\p{S}&&[^/]]" , "")) %>% 
  # Standardize Sports to Title case >> Reduces Sports list from 60 to 54
  mutate(Sport = str_to_title(Sport)) %>%
  # Fixing misspellings >> Reduces Sports list from 54 to 48
  mutate(Sport_Group = recode(Sport,
                              'Artistic Gymnastic' = 'Artistic Gymnastics',
                              'Baseball' = 'Baseball/Softball',
                              'Softball' = 'Baseball/Softball',
                              'Softball/Baseball' = 'Baseball/Softball',
                              'Beach Volley' = 'Beach Volleyball',
                              'Beach Volleybal' = 'Beach Volleyball'
                              )) 

event_schedule_clean_3_tbl %>%
  head(10) %>%
  kable()
```


### 4. Combine the Venue table

```{r}
event_schedule_clean_4_tbl <- event_schedule_clean_3_tbl %>%
  #Joining by Sport and Venue (Both tables have the same field names)
  left_join(venue_details_tbl)
```


```{r}
event_schedule_clean_4_tbl %>%
  head(10) %>%
  kable()
```



### 5. Calculate whether the event is a 'Victory Ceremony' or 'Gold Medal' event. (Note, this might not pick up all of the medal events.)

```{r}
event_type <- 'Victory Ceremony|Gold Medal' 

event_schedule_clean_5_tbl <- event_schedule_clean_4_tbl %>%
  mutate(Medal_Ceremony = str_detect(event_schedule_clean_4_tbl$Events, event_type)) 

event_schedule_clean_5_tbl %>%
  head(10) %>%
  kable()
```

  
### Extra: Split Location into Latitude, Longitude
 
```{r}
event_schedule_clean_6_tbl <- event_schedule_clean_5_tbl %>%
  separate(Location, into = c('Latitude', 'Longitude'), sep = ',') %>%
  mutate(Longitude = str_trim(Longitude)) %>%
  select(Date, Sport_Group, Sport, Events, Medal_Ceremony,Venue, Latitude, Longitude)

event_schedule_clean_6_tbl %>%
  head(10) %>%
  kable()
```
 

### Final Step - Output the Data - Clean Data
```{r}
event_schedule_clean_6_tbl %>%
  write_csv('Output_Data_Olympics_2020.csv')
```




  

