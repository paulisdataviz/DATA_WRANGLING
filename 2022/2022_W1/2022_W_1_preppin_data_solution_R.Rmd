---
title: "2022 W1 Preppin' Data Challenge - R Solution"
author: "Paula Munoz"
date: "2022/01/08"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 2022: Week 1 - The Prep School - Parental Contact Details

Challenge by Carl Allchin.

Challenge Link: <https://preppindata.blogspot.com/2022/01/2022-week-1-prep-school-parental.html>

Data Source: <https://drive.google.com/file/d/1p8gt3cR3ATCeGK81pnT90x0a6dbCXst1/view>

### DETAILS

#### Requirements

- Input the csv file (link above)
- Form the pupil's name correctly for the records in the format Last Name, First Name
- Form the parental contact's name in the same format as the pupil's:
- The Parental Contact Name 1 and 2 are the first names of each parent.
- Use parental contact column to select which parent first name to use along with the pupil's last name
- Create the email address to contact the parent using the format Parent First Name.Parent Last Name@Employer.com
- Create the academic year the pupils are in:
- Each academic year starts on 1st September.
- Year 1 is anyone born after 1st Sept 2014
- Year 2 is anyone born between 1st Sept 2013 and 31st Aug 2014 etc
- Remove any unnecessary columns of data
- Output the data



## LOADING LIBRARIES 

```{r pressure, message=FALSE}
library(tidyverse)
library(skimr)
library(knitr)
library(tidyquant)
library(rvest)
library(ggthemes)

```


## IMPORTING DATA 


Importing data

```{r}
input <- readr::read_csv('additional_files/PD 2022 Wk 1 Input - Input.csv')


```


## INSPECTING DATA 

* Inspecting first five rows:
```{r}
input %>%
  head() %>%
  kable()
```



* Detailed summary:
```{r}
input %>%
  skim()
```


* Glimpse data:
```{r}
input %>%
  glimpse()
```



## DATA WRANGLING

### 1. Form the pupil's name (Last Name, First Name)

```{r}
tidy_data <- input %>%
  mutate(Pupils_Name = str_c(`pupil last name`, ', ',`pupil first name`))

tidy_data%>%
  head(10) %>%
  kable()      
```


### 2. Form the parental contact's name in the same format as the pupil's

```{r}
tidy_data <- tidy_data %>%
  mutate(Parental_Contact_Full_Name = case_when(
    `Parental Contact` == 1 ~ str_c(`pupil last name`, ', ',`Parental Contact Name_1`),
    `Parental Contact` == 2 ~ str_c(`pupil last name`, ', ',`Parental Contact Name_2`)
    )
  )

tidy_data%>%
  head(10) %>%
  kable()   
```



### 3. Create the email address to contact the parent using the format Parent First Name.Parent Last Name@Employer.com

```{r}
tidy_data  <- tidy_data %>%
  mutate(Parental_Contact_Email_Address = 
           str_c(
            (str_split(Parental_Contact_Full_Name,',', simplify = T)[,2]),
            '@',
           `Preferred Contact Employer`,
           '.com'
           )
         )

tidy_data%>%
  head(10) %>%
  kable() 
```


### 4. Create the academic year the pupils are in 

```{r}
tidy_data <- tidy_data %>%
  # Convert Date of Birth to Date Format
  mutate(date = (mdy(tidy_data$`Date of Birth`))) %>%
  # Extract year date
  mutate(year_date = year(date)) %>%
  # Extract month date
  mutate(month_date = month(date)) %>%
  # Adjustment: If month is <= 8 (August) then substract 1 to year (in next step), else substract 0
  mutate(adjustment = ifelse(month_date <= 8, -1, 0 )) %>%
  mutate(year_adjusted = year_date + adjustment) %>%
  mutate(academic_year = case_when( year_adjusted >= 2014 ~ 1,
                     year_adjusted >= 2013 ~ 2,
                     year_adjusted >= 2012 ~ 3,
                     TRUE ~ 4)) %>%
  select(academic_year, Pupils_Name, Parental_Contact_Full_Name, Parental_Contact_Email_Address)

tidy_data%>%
  head(10) %>%
  kable() 
```

